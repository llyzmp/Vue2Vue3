# diff算法

## 阐述vue的diff算法
> 当组件创建和更新时，vue均会执行内部的update函数，该函数内部调用render函数生成虚拟dom，组件会指向新树，然后vue讲新旧两树进行对比，找到差异点，最终更新到真实的dom

对比差异的过程叫diff, vue内部通过一个叫patch的函数完成该过程
在对比时,vue采用深度优先,逐层比较的方式进行比对
在判断两个节点是否相同时,vue是通过虚拟节点的key和tag来判断的
具体来说就是,首先对根节点进行对比,如果相同则将纠结点关联的真实dom的引用挂载到新节点上,然后根据需要更新属性到真实dom,然后在对比子节点数组;如果不相同,则按照新节点信息递归创建所有真实dom,
同时挂到对应的虚拟节点,移除废旧的dom

在对比其子节点数组时,vue对每个子节点数组使用了两个指针,分别指向头和尾,然后不断向中间靠拢进行对比,这样做的目的就是尽量复用真实的dom,尽量少的销毁和创建真实dom,如果发现相同,则进入和根节点一样的对比流程,如果发现不同,则移动真实dom到合适的位置,这样一直递归遍历下去,直到整棵树对比完成

1. diff的时机

> 当组件创建时,以及依赖的属性或数据变化时,会运行一个函数,该函数会做两件事:
- 运行_render函数生成一课新的虚拟dom树(vnode tree)
- 运行_update函数,传入虚拟dom树的根节点,对新旧两棵树进行对比,最终完成真实dom的更新

代码
```js
// vue构造函数
function Vue() {
  // ...其他代码
  var updateComponent = () => {
    this._update(this._render());
  }
  
  new Watcher(updateComponent);
  // ...
}
```
diff就发生在_update函数的运行过程中



