# 阐述对虚拟dom的理解
[toc]

## 1. 什么是虚拟dom

1. 虚拟dom本质上是一个普通的js对象,用于描述视图的界面结构
在vue中,每个组件都有一个render函数,每个render函数都会返回一个虚拟dom树,这就意味着每个组件都对应一棵虚拟dom树

2. 为什么需要虚拟dom
  在vue中,渲染视图会调用render函数,这种渲染不仅发生在组件的创建时,同时发生在视图依赖的数据更新时,如果在渲染时,直接使用真实dom,由于真实dom的创建,更新,插入等操作会带来大量的性能损耗,从而极大的降低渲染效率,  所以vue在渲染时使用虚拟dom来代替真实dom,主要为了解决渲染效率问题

3. 虚拟dom是如何转换为真实dom的

  一个组件实例首次被渲染时,它会先生成虚拟dom树,然后根据虚拟dom树创建真实dom,并把真实dom挂载到页面中的合适位置,此时,每个虚拟dom便会对应一个真实dom
  如果一个组件受响应式数据变化影响,需要重新渲染时,它仍然会重新调用render函数,创建出一个新的虚拟dom树,用新树和旧树对比,通过对比找到最小的更新量,然后更新到必要的虚拟dom节点,最后这些更新过的虚拟节点,会去修改它们真实dom,这样就保证了真实dom达到最小的改动

4. 模板和虚拟dom关系

  vue框架有一个complie模块,它主要负责将模板转换为render函数,而render函数调用后将得到虚拟dom
  编译分为两步
    1. 将模板字符串转换为AST
    2. 将AST转换为render函数
  如果传统的引入方式或vue-cli的配置中开启了`runtimeCompiler:true`,则编译时间会发生在组件第一次加载时,这称之为运行时编译
  如果在vue-cli的默认配置下,编译发生在打包时,这称之为模板预编译
  编译是个极其耗费性能的操作,预编译可以提高运行时的性能,而且运行时就不用编译了,vue-cli在打包时会排除掉vue中complie模块,减少打包体积
  模板的存在仅仅是为了让开发者更加方便书写界面代码
  vue运行时,最终是需要的是render函数,而不是模板,因此模板中的各种语法,在虚拟dom中都已经不存在,他们都会变成虚拟dom的配置

  





